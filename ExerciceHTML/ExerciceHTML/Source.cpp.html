<!DOCTYPE html><head></head><body>#include &lt;iostream&gt;<br>#include &lt;fstream&gt;<br>#include &lt;vector&gt;<br>#include &lt;string&gt;<br>#include &lt;map&gt;<br>#include &lt;regex&gt;<br>#include &lt;algorithm&gt;<br>#include &lt;sstream&gt;<br>#include &lt;chrono&gt;<br>#include &lt;thread&gt;<br>#include &lt;future&gt;<br><br> <span style='color:blue'> using</span>  <span style='color:blue'> namespace</span> std;<br> <span style='color:blue'> using</span>  <span style='color:blue'> namespace</span> std::chrono;<br><br>vector&lt;string&gt; ReadFile( <span style='color:blue'> const</span> string&amp; filename);<br> <span style='color:blue'> void</span> setArguments( <span style='color:blue'> const</span>  <span style='color:blue'> int</span>&amp; argc,  <span style='color:blue'> char</span>* argv[], vector&lt;string&gt; &amp;SourceFiles, vector&lt;string&gt; &amp;Options);<br> <span style='color:blue'> void</span> Write( <span style='color:blue'> const</span> vector&lt;string&gt; &amp;words,  <span style='color:blue'> const</span> string &amp;filename);<br> <span style='color:blue'> void</span> Replace(vector&lt;string&gt; &amp;words,  <span style='color:blue'> const</span> vector&lt;string&gt; &amp;keywords);<br> <span style='color:blue'> void</span> addWords(vector&lt;string&gt; &amp;allWords,  <span style='color:blue'> const</span>  vector&lt;string&gt; &amp; words);<br> <span style='color:blue'> void</span> Transformation( <span style='color:blue'> const</span> vector&lt;string&gt; &amp;keywords, vector&lt;string&gt; &amp;allWords,  <span style='color:blue'> const</span> vector&lt;string&gt; &amp;Files);<br><br> <span style='color:blue'> int</span> main( <span style='color:blue'> int</span> argc,  <span style='color:blue'> char</span>* argv[])<br>{<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; Files;<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; Options;<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; allWords;<br>&nbsp&nbsp&nbsp&nbsp;setArguments(argc, argv, Files, Options);<br><br>&nbsp&nbsp&nbsp&nbsp;// s'il n'y a pas de fichier en paramètre, prendre ce fichier-ci<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> if</span> (!Files.empty())<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;Files.push_back("Source.cpp");<br><br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; keywords = ReadFile("keywords.txt");<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> enum</span> { NTACHESMAX = 8 };<br>&nbsp&nbsp&nbsp&nbsp;ofstream timeFile("Time.txt", fstream::out);<br><br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> int</span> i = 1; i &lt;= NTACHESMAX; ++i)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> const</span>  <span style='color:blue'> int</span> NTACHES = i;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;vector &lt;function&lt; <span style='color:blue'> void</span>()&gt;&gt; fcts;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;fcts.reserve(NTACHES);<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> int</span> i = 0; i &lt; NTACHES; ++i)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;fcts.emplace_back([keywords, Files, &amp;allWords]() {<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> unsigned</span>  <span style='color:blue'> int</span> i = 0; i &lt; Files.size(); ++i)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; words = ReadFile(Files[i]);<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;Replace(words, keywords);<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;Write(words, Files.at(i));<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;addWords(allWords, words);<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;ofstream file(Files[i] + ( <span style='color:blue'> char</span>)i + ".html");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp;s : allWords)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;file &lt;&lt; s;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;file.close();<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;});<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;cout &lt;&lt; string(70, '-') &lt;&lt; '\n' &lt;&lt; "Test (sequentiel, async, pool...), "<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&lt;&lt; NTACHES &lt;&lt; (NTACHES == 1 ? " tache" : " taches") &lt;&lt; endl<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&lt;&lt; "Etape " &lt;&lt; i &lt;&lt; "/" &lt;&lt; NTACHESMAX &lt;&lt; endl;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> auto</span> avant = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp; f : fcts)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;f();<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> auto</span> apres = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;string out = "Excecution sequentielle: " + to_string(duration_cast&lt;milliseconds&gt;(apres - avant).count()) + " ms.";<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;cout &lt;&lt; out &lt;&lt; endl;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;timeFile &lt;&lt; out &lt;&lt; endl;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;cout &lt;&lt; "Test parallele" &lt;&lt; endl;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;vector&lt;future&lt; <span style='color:blue'> void</span>&gt;&gt; v;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> auto</span> avant = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp; f : fcts)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;v.emplace_back(async(f));<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp; f : v)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;f.wait();<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> auto</span> apres = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;string out = "Execution parallele (async) : " + to_string(duration_cast&lt;milliseconds&gt;(apres - avant).count()) + " ms.";<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;cout &lt;&lt; out &lt;&lt; endl;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;timeFile &lt;&lt; out &lt;&lt; endl;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;cin.get();<br>}<br><br> <span style='color:blue'> void</span> setArguments( <span style='color:blue'> const</span>  <span style='color:blue'> int</span>&amp; argc,  <span style='color:blue'> char</span>* argv[], vector&lt;string&gt; &amp;SourceFiles, vector&lt;string&gt; &amp;Options)<br>{<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> int</span> i = 0; i &lt; argc; ++i)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;string param = argv[i];<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> if</span> (param[0] == '-' || param[0] == '/')<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;Options.push_back(param.substr(1));<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> else</span><br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;SourceFiles.push_back(param);<br>&nbsp&nbsp&nbsp&nbsp;}<br>}<br><br>vector&lt;string&gt; ReadFile( <span style='color:blue'> const</span> string&amp; filename) <br>{<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; sentences;<br>&nbsp&nbsp&nbsp&nbsp;ifstream file(filename);<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> if</span> (file)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> (string line; getline(file, line);)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;sentences.push_back(line);<br>&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> return</span> sentences;<br>}<br><br> <span style='color:blue'> void</span> Write( <span style='color:blue'> const</span> vector&lt;string&gt; &amp;words, <span style='color:blue'> const</span> string &amp;filename)<br>{<br>&nbsp&nbsp&nbsp&nbsp;ofstream file(filename + ".html");<br>&nbsp&nbsp&nbsp&nbsp;file &lt;&lt; "&lt;!DOCTYPE html&gt;" &lt;&lt; "&lt;head&gt;&lt;/head&gt;&lt;body&gt;";<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> unsigned</span>  <span style='color:blue'> int</span> i = 0; i &lt; words.size(); ++i)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;file &lt;&lt; words.at(i) &lt;&lt; "&lt;br&gt;" &lt;&lt; flush;<br>&nbsp&nbsp&nbsp&nbsp;file &lt;&lt; "&lt;/body&gt;&lt;/html&gt;";<br>}<br><br> <span style='color:blue'> void</span> Replace(vector&lt;string&gt; &amp;words,  <span style='color:blue'> const</span> vector&lt;string&gt; &amp;keywords)<br>{<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span>( <span style='color:blue'> auto</span> debut = begin(words); debut != end(words); ++debut)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, regex{ "&amp;" }, "&amp;amp;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, regex{ "&lt;" }, "&amp;lt;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, regex{ "&gt;" }, "&amp;gt;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, regex{ "\\t" }, "&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> keywordPos = begin(keywords); keywordPos != end(keywords); ++keywordPos)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;regex expression("\\b" + *keywordPos + "\\b");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, expression, " &lt;span style='color:blue'&gt; " + *keywordPos + "&lt;/span&gt;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;}<br><br>}<br><br> <span style='color:blue'> void</span> addWords(vector&lt;string&gt; &amp;allWords, <span style='color:blue'> const</span>  vector&lt;string&gt; &amp; words)<br>{<br>&nbsp&nbsp&nbsp&nbsp;allWords.insert(end(allWords), begin(words), end(words));<br>}<br><br> <span style='color:blue'> void</span> Transformation( <span style='color:blue'> const</span> vector&lt;string&gt; &amp;keywords, vector&lt;string&gt; &amp;allWords,  <span style='color:blue'> const</span> vector&lt;string&gt; &amp;Files)<br>{<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> unsigned</span>  <span style='color:blue'> int</span> i = 0; i &lt; Files.size(); ++i)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; words = ReadFile(Files.at(i));<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;Replace(words, keywords);<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;Write(words, Files.at(i));<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;addWords(allWords, words);<br>&nbsp&nbsp&nbsp&nbsp;}<br>}<br></body></html>