<!DOCTYPE html><head></head><body>#include &lt;iostream&gt;<br>#include &lt;fstream&gt;<br>#include &lt;vector&gt;<br>#include &lt;string&gt;<br>#include &lt;map&gt;<br>#include &lt;regex&gt;<br>#include &lt;algorithm&gt;<br>#include &lt;sstream&gt;<br>#include &lt;chrono&gt;<br>#include &lt;thread&gt;<br>#include &lt;future&gt;<br>#include "ThreadPool.h"<br><br> <span style='color:blue'> using</span>  <span style='color:blue'> namespace</span> std;<br> <span style='color:blue'> using</span>  <span style='color:blue'> namespace</span> std::chrono;<br><br>vector&lt;string&gt; ReadFile( <span style='color:blue'> const</span> string&amp; filename);<br> <span style='color:blue'> void</span> setArguments( <span style='color:blue'> const</span>  <span style='color:blue'> int</span>&amp; argc,  <span style='color:blue'> char</span>* argv[], vector&lt;string&gt; &amp;SourceFiles);<br> <span style='color:blue'> void</span> Write( <span style='color:blue'> const</span> vector&lt;string&gt; &amp;words,  <span style='color:blue'> const</span> string &amp;filename);<br> <span style='color:blue'> void</span> Replace(vector&lt;string&gt; &amp;words,  <span style='color:blue'> const</span> vector&lt;string&gt; &amp;keywords);<br> <span style='color:blue'> void</span> Transformation( <span style='color:blue'> const</span> vector&lt;string&gt; &amp;keywords, string FileName);<br><br> <span style='color:blue'> int</span> main( <span style='color:blue'> int</span> argc,  <span style='color:blue'> char</span>* argv[])<br>{<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; Files;<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; allWords;<br>&nbsp&nbsp&nbsp&nbsp;ofstream timeFile("Time.txt", std::ios_base::app);<br>&nbsp&nbsp&nbsp&nbsp;setArguments(argc, argv, Files);<br><br>&nbsp&nbsp&nbsp&nbsp;// s'il n'y a pas de fichier en paramètre, prendre ce fichier-ci<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> if</span> (!Files.empty())<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;Files.push_back("Source.cpp");<br><br>&nbsp&nbsp&nbsp&nbsp;vector &lt;function&lt; <span style='color:blue'> void</span>()&gt;&gt; fcts;<br>&nbsp&nbsp&nbsp&nbsp;fcts.reserve(Files.size());<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; keywords = ReadFile("keywords.txt");<br>&nbsp&nbsp&nbsp&nbsp;ThreadPool pool;<br>&nbsp&nbsp&nbsp&nbsp;string out;<br><br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> auto</span> avant = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> (string &amp;s : Files)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;fcts.push_back([keywords, Files, &amp;allWords]() {<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> unsigned</span>  <span style='color:blue'> int</span> i = 0; i &lt; Files.size(); ++i)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; words = ReadFile(Files[i]);<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;Replace(words, keywords);<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;Write(words, Files.at(i));<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;ofstream file(Files[i] + ( <span style='color:blue'> char</span>)i + ".html");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp;s : allWords)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;file &lt;&lt; s;<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;file.close();<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;});<br>&nbsp&nbsp&nbsp&nbsp;}<br><br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp;f : fcts)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;pool.add_task(f);<br>&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;pool.meurs();<br>&nbsp&nbsp&nbsp&nbsp;pool.wait_end();<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> auto</span> apres = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp;out = "Chrono thread: " + to_string(duration_cast&lt;milliseconds&gt;(apres - avant).count()) + " ms.";<br>&nbsp&nbsp&nbsp&nbsp;cout &lt;&lt; out &lt;&lt; endl;<br>&nbsp&nbsp&nbsp&nbsp;timeFile &lt;&lt; out &lt;&lt; endl;<br><br>&nbsp&nbsp&nbsp&nbsp;avant = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp;f : fcts)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;f();<br>&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;apres = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp;out = "Séquentielle: " + to_string(duration_cast&lt;milliseconds&gt;(apres - avant).count()) + " ms.";<br>&nbsp&nbsp&nbsp&nbsp;cout &lt;&lt; out &lt;&lt; endl;<br>&nbsp&nbsp&nbsp&nbsp;timeFile &lt;&lt; out &lt;&lt; endl;<br><br>&nbsp&nbsp&nbsp&nbsp;avant = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;future&lt; <span style='color:blue'> void</span>&gt;&gt; v;<br><br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp; f : fcts)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;v.emplace_back(async(f));<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp; f : v)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;f.wait();<br><br>&nbsp&nbsp&nbsp&nbsp;apres = system_clock::now();<br>&nbsp&nbsp&nbsp&nbsp;out = "Parallèle: " + to_string(duration_cast&lt;milliseconds&gt;(apres - avant).count()) + " ms.";<br>&nbsp&nbsp&nbsp&nbsp;cout &lt;&lt; out &lt;&lt; endl;<br>&nbsp&nbsp&nbsp&nbsp;timeFile &lt;&lt; out &lt;&lt; endl;<br>}<br><br> <span style='color:blue'> void</span> setArguments( <span style='color:blue'> const</span>  <span style='color:blue'> int</span>&amp; argc,  <span style='color:blue'> char</span>* argv[], vector&lt;string&gt; &amp;SourceFiles)<br>{<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> int</span> i = 0; i &lt; argc; ++i)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;string param = argv[i];<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;SourceFiles.push_back(param);<br>&nbsp&nbsp&nbsp&nbsp;}<br>}<br><br>vector&lt;string&gt; ReadFile( <span style='color:blue'> const</span> string&amp; filename)<br>{<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; sentences;<br>&nbsp&nbsp&nbsp&nbsp;ifstream file(filename);<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> if</span> (file)<br>&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> (string line; getline(file, line);)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;sentences.push_back(line);<br>&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> return</span> sentences;<br>}<br><br> <span style='color:blue'> void</span> Write( <span style='color:blue'> const</span> vector&lt;string&gt; &amp;words,  <span style='color:blue'> const</span> string &amp;filename)<br>{<br>&nbsp&nbsp&nbsp&nbsp;ofstream file(filename + ".html");<br>&nbsp&nbsp&nbsp&nbsp;file &lt;&lt; "&lt;!DOCTYPE html&gt;" &lt;&lt; "&lt;head&gt;&lt;/head&gt;&lt;body&gt;";<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> unsigned</span>  <span style='color:blue'> int</span> i = 0; i &lt; words.size(); ++i)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;file &lt;&lt; words.at(i) &lt;&lt; "&lt;br&gt;" &lt;&lt; flush;<br>&nbsp&nbsp&nbsp&nbsp;file &lt;&lt; "&lt;/body&gt;&lt;/html&gt;";<br>}<br><br> <span style='color:blue'> void</span> Replace(vector&lt;string&gt; &amp;words,  <span style='color:blue'> const</span> vector&lt;string&gt; &amp;keywords)<br>{<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> debut = begin(words); debut != end(words); ++debut)<br>&nbsp&nbsp&nbsp&nbsp;{<br><br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, regex{ "&amp;" }, "&amp;amp;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, regex{ "&lt;" }, "&amp;lt;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, regex{ "&gt;" }, "&amp;gt;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, regex{ "\\t" }, "&amp;nbsp&amp;nbsp&amp;nbsp&amp;nbsp;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> keywordPos = begin(keywords); keywordPos != end(keywords); ++keywordPos)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;{<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;regex expression("\\b" + *keywordPos + "\\b");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;*debut = regex_replace(*debut, expression, " &lt;span style='color:blue'&gt; " + *keywordPos + "&lt;/span&gt;");<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;}<br>&nbsp&nbsp&nbsp&nbsp;}<br><br>}<br><br> <span style='color:blue'> void</span> Transformation( <span style='color:blue'> const</span> vector&lt;string&gt; &amp;keywords, string FileName)<br>{<br>&nbsp&nbsp&nbsp&nbsp;vector&lt;string&gt; words = ReadFile(FileName);<br>&nbsp&nbsp&nbsp&nbsp;Replace(words, keywords);<br>&nbsp&nbsp&nbsp&nbsp;Write(words, FileName);<br>&nbsp&nbsp&nbsp&nbsp;ofstream file(FileName + ".html");<br>&nbsp&nbsp&nbsp&nbsp; <span style='color:blue'> for</span> ( <span style='color:blue'> auto</span> &amp;s : words)<br>&nbsp&nbsp&nbsp&nbsp;&nbsp&nbsp&nbsp&nbsp;file &lt;&lt; s;<br>&nbsp&nbsp&nbsp&nbsp;file.close();<br>}<br></body></html>